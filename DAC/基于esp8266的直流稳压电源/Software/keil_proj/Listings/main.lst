C51 COMPILER V9.60.0.0   MAIN                                                              12/18/2020 17:14:37 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\keil5_ARM\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "reg52.h"
   2          
   3          typedef unsigned int u16;   
   4          typedef unsigned char u8;
   5          
   6          
   7          //Êé•Âè£ÂÆö‰πâ
   8          #define SMG_DATA P0 //Êï∞Á†ÅÁÆ°Êï∞ÊçÆÊé•Âè£
   9          #define DAC_DATA P1 //dacÊï∞ÊçÆÊé•Âè£
  10          sbit LSA=P2^6;
  11          sbit LSB=P2^5;
  12          sbit LSC=P2^4;
  13          sbit K1=P2^0; //Âä†ÈîÆ
  14          sbit K2=P2^1; //ÂáèÈîÆ
  15          sbit K3=P2^2; //ÂΩíÈõ∂ÈîÆ
  16          sbit K4=P2^3; //ÊÅØÂ±èÈîÆ
  17          sbit beep=P2^7; //ËúÇÈ∏£Âô®
  18          u8 code smg[11]={0xd7,0x14,0xcd,0x5d,0x1e,0x5b,0xdb,0x15,0xdf,0x5f};  //Èò¥ÊûÅÊï∞Á†ÅÁÆ°ÊÆµÁ†Å
  19          //u8 code smg[17]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  20                    //0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};//ÊòæÁ§∫0~FÁöÑÂÄº
  21          
  22          //ÂÖ®Â±ÄÂèòÈáèÂÆö‰πâ
  23          u8 w; //‰ΩçÈÄâÂÄº
  24          u8 is_display=1;  //ÊòØÂê¶ÂºÄÂêØÂ±èÊòæÔºåÈªòËÆ§ÂºÄÂêØ
  25          u8 now_v=0,STEP=5;  //ÂΩìÂâçÁöÑÁîµÂéãÂÄº=now_v/10+20,Ê≠•Ëøõ‰Ωç5
  26          u8 delay_time=150;  //ÊåâÈîÆËØÜÂà´‰∏∫ÈïøÊåâÈó¥ÈöîÊó∂Èó¥:1.5s
  27          u8 count1,count2,start=0,count_v=0;   //ÂÆöÊó∂Âô®ÂèòÈáè
  28          
  29          
  30          //Âª∂Êó∂ÂáΩÊï∞
  31          void delay_ms(u16 xms)
  32          {
  33   1        u16 x,y;
  34   1        for(x=xms;x>0;x--)
  35   1          for(y=110;y>0;y--);
  36   1      }
  37          //Èò¥ÊûÅÊï∞Á†ÅÁÆ°ÊòæÁ§∫‰∫ã‰ª∂
  38          void Display(){
  39   1        if(is_display==1){
  40   2        for(w=0;w<3;w++)
  41   2        {
  42   3          switch(w)
  43   3          {
  44   4            case(0):LSC=1;LSA=0;SMG_DATA=smg[(now_v+20)/100];delay_ms(5);SMG_DATA=0x00;break;     //ÂçÅ‰ΩçÊï∞
  45   4            case(1):LSA=1;LSB=0;SMG_DATA=smg[(now_v+20)%100/10]^0x80;delay_ms(5);SMG_DATA=0x00;break; //‰∏™‰ΩçÊï∞Ôº
             -åÁ¨¨‰∏â‰ΩçÊòæÁ§∫Â∞èÊï∞ÁÇπ
  46   4            case(2):LSB=1;LSC=0;SMG_DATA=smg[(now_v+20)%10];delay_ms(5);SMG_DATA=0x00;break;      //ÂçÅÂàÜ‰Ωç
  47   4          }
  48   3        }
  49   2        }
  50   1        else{   //ÂÖ≥Èó≠ÊòæÁ§∫ÂäüËÉΩ
  51   2        LSA=LSB=LSC=0;
  52   2        SMG_DATA=0x00;
  53   2        }
C51 COMPILER V9.60.0.0   MAIN                                                              12/18/2020 17:14:37 PAGE 2   

  54   1      }
  55          //ÈîÆÁõòÊâ´Êèè‰∫ã‰ª∂
  56          void KeyScan(){
  57   1        if(K1!=1||K2!=1||K3!=1|K4!=1){
  58   2          delay_ms(100);//Ê∂àÊäñ
  59   2          if(K1==0){  //Âä†ÈîÆË¢´Êåâ‰∏ã
  60   3            count1=count2=0;
  61   3            if(now_v<160){
  62   4              now_v+=STEP;
  63   4              DAC_DATA=now_v;
  64   4              while(!K1){ //Á≠âÂæÖÊåâÈîÆÊùæÂºÄ
  65   5                Display();
  66   5                if(start&&count_v>0&&now_v<160){
  67   6                now_v+=count_v;
  68   6                count_v=0;
  69   6                }
  70   5                DAC_DATA=now_v;
  71   5              }
  72   4          }
  73   3            else{
  74   4            DAC_DATA=now_v=160;
  75   4            beep=1;
  76   4            while(!K1){ //Á≠âÂæÖÊåâÈîÆÊùæÂºÄ
  77   5            Display();}
  78   4            }
  79   3            start=0;  //Â∞ÜÈïøÊåâÂäüËÉΩÂÖ≥Èó≠
  80   3            beep=0;
  81   3        }
  82   2          //ÁîµÂéãÂáè
  83   2            if(K2==0){
  84   3              count1=count2=0;
  85   3              if(now_v>0){  //now_vÂÄº‰∏ç‰∏∫0
  86   4              now_v-=STEP;
  87   4              DAC_DATA=now_v;
  88   4              while(!K2){ //Á≠âÂæÖÊåâÈîÆÊùæÂºÄ
  89   5                Display();
  90   5              if(start&&count_v>0&&now_v>0){
  91   6                now_v-=count_v;
  92   6                count_v=0;
  93   6                }
  94   5                DAC_DATA=now_v;
  95   5              }
  96   4            }
  97   3              else{
  98   4                DAC_DATA=now_v=0;
  99   4                beep=1;   //ËúÇÈ∏£Âô®ÂºÄÂßãË≠¶Âëä
 100   4                while(!K2){ //Á≠âÂæÖÊåâÈîÆÊùæÂºÄ
 101   5                Display();}
 102   4              }
 103   3              start=0;  //Â∞ÜÈïøÊåâÂäüËÉΩÂÖ≥Èó≠
 104   3              beep=0;
 105   3            }
 106   2          //Ê∏ÖÈõ∂
 107   2          if(K3==0){
 108   3          while(now_v>=10){
 109   4            now_v-=10;
 110   4            DAC_DATA=now_v;
 111   4            delay_ms(20);
 112   4            Display();
 113   4          }
 114   3          DAC_DATA=now_v=0;
 115   3          Display();
C51 COMPILER V9.60.0.0   MAIN                                                              12/18/2020 17:14:37 PAGE 3   

 116   3          while(!K3){   //Á≠âÂæÖÊåâÈîÆÊùæÂºÄ
 117   4            Display();
 118   4          }
 119   3        }
 120   2          //ÊÅØÂ±èÊàñÂêØÂ±è
 121   2          if(K4==0){
 122   3          is_display=~is_display;
 123   3          while(!K4);}
 124   2        }
 125   1      }
 126          //ÂàùÂßãÂåñÂÆöÊó∂Âô®0
 127          void InitTimer0(void)
 128          {
 129   1          TMOD=0x01;//1.Ê®°ÂºèËÆæÁΩÆÔºå00000001ÔºåÈááÁî®ÁöÑÊòØÂÆöÊó∂Âô®0ÔºåÂ∑•‰Ωú‰∏éÂºè1ÔºàM1=0ÔºåM0=1Ôºâ„ÄÇ
 130   1          TH0=(65536-10000)/256;  //2.ÂÆöÊó∂Âô®ËÆæÁΩÆÔºåÊØèÈöî10ÊØ´ÁßíÂèëËµ∑‰∏ÄÊ¨°‰∏≠Êñ≠„ÄÇ
 131   1          TL0=(65536-10000)%256;
 132   1          ET0=1;                  //3.ÂºÄÂÆöÊó∂Âô®0‰∏≠Êñ≠
 133   1          EA = 1;                 //4.ÂºÄÊÄª‰∏≠Êñ≠
 134   1          TR0=1;                  //5.ÊâìÂºÄÂÆöÊó∂Âô®
 135   1      }
 136          void main()
 137          { 
 138   1        InitTimer0();
 139   1        beep=0;
 140   1        while(1)
 141   1        { 
 142   2          Display();
 143   2          KeyScan();
 144   2      }
 145   1        }
 146          
 147          void Timer0Interrupt(void) interrupt 1
 148          {
 149   1          TH0=(65536-10000)/256;  //2.ÂÆöÊó∂Âô®ËÆæÁΩÆÔºåÊØèÈöî10ÊØ´ÁßíÂèëËµ∑‰∏ÄÊ¨°‰∏≠Êñ≠„ÄÇ
 150   1          TL0=(65536-10000)%256;
 151   1        count1++; //10msÂä†‰∏ÄÊï∞
 152   1        if(count1>=delay_time){
 153   2          count1=0; //Ê∏ÖÈõ∂ÔºåÈò≤Ê≠¢ÂÜÖÂ≠òÊ∫¢Âá∫
 154   2          start=1;  //ÈïøÊåâ1.5s‰ª•‰∏äÔºåÊåâÈîÆ‰∏∫ÈïøÊåâÁä∂ÊÄÅÔºåÂºÄÂßãÈöî0.5sÁ¥ØÂä†1
 155   2        }
 156   1        if(start) count2++;
 157   1        if(count2>=50){count2=0;count_v=STEP;}
 158   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    551    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
